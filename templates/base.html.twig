<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AGS | Stock Intelligence{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root{
            --emsi-blue:#1a73e8;
            --sidebar-width:280px;

            /* Premium palette */
            --sidebar-bg-1:#0b5ed7;
            --sidebar-bg-2:#0a3d91;

            --sidebar-hover:rgba(255,255,255,.10);
            --sidebar-active:rgba(255,255,255,.18);

            --text:#0f172a;
            --muted:#64748b;
            --page:#f8fafc;
            --card:#ffffff;

            --radius:16px;
        }

        *{ box-sizing:border-box; }
        body{
            background: var(--page);
            font-family:'Inter',sans-serif;
            color: var(--text);
            margin:0;
        }

        /* ===== SIDEBAR ===== */
        .sidebar{
            width:var(--sidebar-width);
            height:100vh;
            position:fixed;
            left:0; top:0;
            padding: 1.6rem 1.15rem;
            display:flex;
            flex-direction:column;
            z-index:1000;

            /* Premium background */
            background:
                radial-gradient(1200px 600px at 20% 10%, rgba(255,255,255,.18), transparent 40%),
                radial-gradient(800px 500px at 80% 90%, rgba(255,255,255,.10), transparent 45%),
                linear-gradient(160deg, var(--sidebar-bg-1), var(--sidebar-bg-2));

            /* IMPORTANT pour la transition (pas de border-right brutale) */
            overflow: visible;

            /* Shadow premium + glow interne lÃ©ger */
              box-shadow:
        12px 0 22px rgba(2,6,23,.14),
        inset -1px 0 0 rgba(255,255,255,.05); 
    }

        /* ===== TRANSITION PREMIUM SIDEBAR â†’ CONTENU ===== */
      /* ===== TRANSITION SIDEBAR â†’ CONTENU (CORRIGÃ‰E) ===== */
/* ===== TRANSITION SIDEBAR â†’ CONTENU (VERSION FINALE) ===== */
.sidebar::after{
    content:"";
    position:absolute;
    top:0;
    left:100%;            /* ðŸ”¥ clÃ© du problÃ¨me : sort du sidebar */
    width:28px;
    height:100%;
    pointer-events:none;
    z-index:0;

    background: linear-gradient(
        to right,
        rgba(10, 61, 145, 0.35),
        rgba(10, 61, 145, 0.20),
        rgba(10, 61, 145, 0.08),
        rgba(248, 250, 252, 0.00)
    );
}

        .brand{
            display:flex;
            align-items:center;
            justify-content:flex-start;
            gap:.8rem;
            text-decoration:none;
            padding:.35rem .6rem;
            border-radius: 14px;
            margin-bottom: 1.25rem !important;
        }

        .sidebar-logo{
            width: 150px;
            height:auto;
            filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
        }

        .sidebar-nav-content{
            flex:1;
            display:flex;
            flex-direction:column;
            overflow:auto;
            padding-right:.2rem;
        }

        /* scrollbar discret */
        .sidebar-nav-content::-webkit-scrollbar{ width:6px; }
        .sidebar-nav-content::-webkit-scrollbar-thumb{
            background: rgba(255,255,255,.18);
            border-radius:999px;
        }

        .sidebar-section{
            font-size:.72rem;
            letter-spacing:.14em;
            text-transform:uppercase;
            color:rgba(255,255,255,.60);
            margin:.75rem .6rem .35rem;
        }

        .nav-link{
            color:rgba(255,255,255,.84);
            border-radius:14px;
            padding:.85rem 1rem;
            margin-bottom:.35rem;
            transition: all .22s ease;
            display:flex;
            align-items:center;
            gap:.65rem;
            text-decoration:none;
            font-weight:600;
            border:1px solid transparent;
            background: rgba(255,255,255,.00);
        }

        .nav-link i{
            width:34px;
            font-size:1.05rem;
            opacity:.95;
        }

        .nav-link:hover{
            color:#fff;
            background: var(--sidebar-hover);
            border-color: rgba(255,255,255,.10);
            transform: translateX(2px);
        }

        .nav-link.active{
            color:#fff;
            background: var(--sidebar-active);
            border-color: rgba(255,255,255,.18);
            box-shadow: 0 10px 22px rgba(0,0,0,.18);
        }

        /* indicateur dot active */
        .nav-link.active::after{
            content:"";
            width:8px; height:8px;
            border-radius:50%;
            background: rgba(255,255,255,.95);
            margin-left:auto;
            box-shadow: 0 0 0 6px rgba(255,255,255,.12);
        }

        .sidebar-divider{
            border-top:1px solid rgba(255,255,255,.10);
            margin: 1.1rem .6rem;
        }

        .badge-premium{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            min-width:26px;
            height:22px;
            padding:0 10px;
            border-radius:999px;
            font-size:.72rem;
            font-weight:700;
            background: rgba(255,255,255,.18);
            border:1px solid rgba(255,255,255,.18);
            color:#fff;
            box-shadow: 0 10px 18px rgba(0,0,0,.18);
        }

        .logout-container{
            margin-top:auto;
            padding-top:.8rem;
        }

        .logout-link:hover{
            background: rgba(255, 75, 92, .12) !important;
            border-color: rgba(255, 75, 92, .18) !important;
            color:#ffb4bb !important;
        }

        /* ===== HEADER ===== */
        .top-header{
            margin-left:var(--sidebar-width);
            height:82px;
            padding: 0 3rem;
            display:flex;
            align-items:center;
            justify-content:space-between;
            position:sticky;
            top:0;
            z-index:999;

            background: rgba(255,255,255,.72);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(148,163,184,.25);
        }

        .search-box{
            position:relative;
            width:440px;
        }
        .search-box input{
            width:100%;
            padding:.75rem 1rem .75rem 3rem;
            border-radius:14px;
            border:1px solid rgba(148,163,184,.35);
            background: rgba(248,250,252,.92);
            outline:none;
            transition:.2s;
        }
        .search-box input:focus{
            border-color: rgba(26,115,232,.55);
            box-shadow: 0 0 0 .25rem rgba(26,115,232,.12);
        }
        .search-box i{
            position:absolute;
            left:1.05rem;
            top:50%;
            transform:translateY(-50%);
            color:#64748b;
        }

        .user-area{
            display:flex;
            align-items:center;
            gap:1rem;
            padding-left:1.25rem;
            border-left:1px solid rgba(148,163,184,.25);
        }

        .avatar{
            width:45px; height:45px;
            border-radius:999px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:800;
            color:#fff;
            background: linear-gradient(135deg, #1a73e8, #0ea5e9);
            box-shadow: 0 12px 24px rgba(2,6,23,.14);
            border:1px solid rgba(255,255,255,.35);
        }

        /* ===== CONTENT ===== */
        .content{
            margin-left:var(--sidebar-width);
            padding: 2.75rem 3rem;
            min-height: calc(100vh - 82px);
        }

        /* Responsive */
        @media (max-width: 1200px){
            .search-box{ width: 320px; }
            .content{ padding: 2.25rem 2rem; }
            .top-header{ padding: 0 2rem; }
        }
        @media (max-width: 992px){
            .search-box{ display:none; }
        }
    </style>
</head>

<body>

<aside class="sidebar">
    <a href="{{ path('admin_dashboard') }}" class="brand">
        <img src="{{ asset('images/logo.png') }}" alt="Logo AGS" class="sidebar-logo">
    </a>

    <nav class="sidebar-nav-content">

        <div class="sidebar-section">Navigation</div>

        {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('admin_dashboard') }}"
               class="nav-link {{ app.request.get('_route') == 'admin_dashboard' ? 'active' : '' }}">
                <i class="fas fa-th-large"></i> Dashboard
            </a>
            <div class="sidebar-divider"></div>
        {% endif %}

        <a href="{{ path('admin_product_index') }}"
           class="nav-link {{ app.request.get('_route') starts with 'admin_product' ? 'active' : '' }}">
            <i class="fas fa-box"></i> Products
        </a>

        {% if is_granted('ROLE_MANAGER') or is_granted('ROLE_ADMIN') %}
            <a href="{{ path('admin_supplier_index') }}"
               class="nav-link {{ app.request.get('_route') starts with 'admin_supplier' ? 'active' : '' }}">
                <i class="fas fa-truck"></i> Supplier
            </a>
        {% endif %}

        {% if is_granted('ROLE_MANAGER') or is_granted('ROLE_ADMIN') %}
            <a href="{{ path('admin_purchase_index') }}"
               class="nav-link {{ app.request.get('_route') starts with 'admin_purchase' ? 'active' : '' }} d-flex justify-content-between align-items-center">
                <span class="d-flex align-items-center">
                    <i class="fas fa-file-alt"></i> Demandes
                </span>

                <span class="badge-premium">
                    {{ render(controller('App\\Controller\\Admin\\PurchaseRequestController::countPending')) }}
                </span>
            </a>
        {% endif %}

        <a href="{{ path('admin_category_index') }}"
           class="nav-link {{ app.request.get('_route') starts with 'admin_category' ? 'active' : '' }}">
            <i class="fas fa-tags"></i> Categories
        </a>

        <a href="{{ path('admin_movement_index') }}"
           class="nav-link {{ app.request.get('_route') starts with 'admin_movement' ? 'active' : '' }}">
            <i class="fas fa-exchange-alt"></i> Mouvements
        </a>
    </nav>

    <div class="logout-container">
        <a href="{{ path('app_logout') }}" class="nav-link logout-link">
            <i class="fas fa-power-off"></i> DÃ©connexion
        </a>
    </div>
</aside>

<header class="top-header">
    <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="global-search" placeholder="Rechercher...">
    </div>

    <div class="user-area">
        {% if app.user %}
            <div class="text-end">
                <div class="fw-bold small text-dark">
                    {{ is_granted('ROLE_ADMIN') ? 'Administrateur' : 'Utilisateur' }}
                </div>
                <div class="text-muted small" style="font-size:11px;">
                    {{ app.user.email }}
                </div>
            </div>

            {% set email = app.user.email ?? '' %}
            {% set initials = (email|slice(0,1)|upper) ~ (email|slice(1,1)|upper) %}
            <div class="avatar">{{ initials }}</div>
        {% endif %}
    </div>
</header>

<main class="content">
    {% block body %}{% endblock %}
</main>

<script>
    // Recherche en temps rÃ©el
    document.getElementById('global-search')?.addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        document.querySelectorAll('.content table tbody tr').forEach(row => {
            row.style.display = row.textContent.toLowerCase().includes(filter) ? '' : 'none';
        });
    });

    // Export Excel
    function exportToExcel(tableId, fileName = 'Export_AGS') {
        const table = document.getElementById(tableId);
        if (!table) return alert("Tableau introuvable !");
        const workbook = XLSX.utils.table_to_book(table, { sheet: "DonnÃ©es" });
        XLSX.writeFile(workbook, fileName + ".xlsx");
    }
</script>

</body>
</html>
